# for Image Template
ICP_PATH=/opt/icp310cn
apt update
apt install -y python-minimal
apt install -y socat
cd /root
/root/icp-docker-18.03.1_x86_64.bin --install
sed -i.bak s/max-size=50m/max-size=10m/ /lib/systemd/system/docker.service
systemctl daemon-reload
systemctl restart docker
tar xf ibm-cloud-private-x86_64-3.1.0.tar.gz -O | docker load
mkdir $ICP_PATH; cd $ICP_PATH
docker run -v $(pwd):/data -e LICENSE=accept ibmcom/icp-inception-amd64:3.1.0-ee cp -r cluster /data
mkdir $ICP_PATH/cluster/images
mv /root/ibm-cloud-private-x86_64-3.1.0.tar.gz $ICP_PATH/cluster/images
ssh-keygen -b 4096 -f /root/.ssh/id_rsa -N ""
cat /root/.ssh/id_rsa.pub | tee -a /root/.ssh/authorized_keys
cp /root/.ssh/id_rsa $ICP_PATH/cluster/ssh_key
